<div class="glossary-page">

  <div class="glossary-header">
    <h1>ğŸ“– Glossaire Data Science</h1>
    <p class="glossary-subtitle"><%= GLOSSARY.length %> termes Â· Recherche instantanÃ©e Â· Liens vers les workflows</p>
  </div>

  <!-- Search + Filters -->
  <div class="glossary-controls">
    <div class="glossary-search">
      <span class="search-icon">ğŸ”</span>
      <input type="text" id="glossarySearch" placeholder="Chercher un terme..." autocomplete="off">
    </div>
    <div class="glossary-filters" id="glossaryFilters">
      <button class="filter-btn active" data-cat="all">Tout (<%= GLOSSARY.length %>)</button>
      <% @categories.each do |cat| %>
        <button class="filter-btn" data-cat="<%= cat %>">
          <%= cat %> (<%= GLOSSARY.count { |t| t[:category] == cat } %>)
        </button>
      <% end %>
    </div>
  </div>

  <!-- Terms list -->
  <div class="glossary-list" id="glossaryList">
    <% @terms.each do |t| %>
      <div class="glossary-card" data-category="<%= t[:category] %>" data-term="<%= t[:term].downcase %>">
        <div class="glossary-card-top">
          <h3 class="glossary-term"><%= t[:term] %></h3>
          <span class="glossary-cat cat-<%= t[:category].parameterize %>"><%= t[:category] %></span>
        </div>
        <p class="glossary-def"><%= t[:definition] %></p>
        <% if t[:code] %>
          <div class="glossary-code">
            <pre><code class="language-python"><%= t[:code] %></code></pre>
          </div>
        <% end %>
        <a href="<%= workflow_path(t[:workflow]) %>" class="glossary-link">
          â†’ voir dans <strong><%= WORKFLOWS.find { |w| w[:slug] == t[:workflow] }&.dig(:title) || t[:workflow] %></strong>
        </a>
      </div>
    <% end %>
  </div>

  <div class="glossary-empty" id="glossaryEmpty" style="display:none;">
    Aucun terme trouvÃ© ğŸ¤·
  </div>

</div>

<script>
  // Highlight.js
  document.querySelectorAll('.glossary-code code').forEach(el => hljs.highlightElement(el));

  const search = document.getElementById('glossarySearch');
  const cards = document.querySelectorAll('.glossary-card');
  const filters = document.querySelectorAll('.filter-btn');
  const empty = document.getElementById('glossaryEmpty');
  let activeCat = 'all';

  function filterCards() {
    const query = search.value.toLowerCase().trim();
    let visible = 0;
    cards.forEach(card => {
      const matchCat = activeCat === 'all' || card.dataset.category === activeCat;
      const matchSearch = !query || card.dataset.term.includes(query) ||
                          card.querySelector('.glossary-def').textContent.toLowerCase().includes(query);
      const show = matchCat && matchSearch;
      card.style.display = show ? '' : 'none';
      if (show) visible++;
    });
    empty.style.display = visible === 0 ? '' : 'none';
  }

  search.addEventListener('input', filterCards);

  filters.forEach(btn => {
    btn.addEventListener('click', () => {
      filters.forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      activeCat = btn.dataset.cat;
      filterCards();
    });
  });
</script>
