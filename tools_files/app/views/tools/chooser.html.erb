<div class="chooser-page">

  <div class="chooser-header">
    <div class="chooser-header-icon">ğŸ§­</div>
    <h1>Quel modÃ¨le choisir ?</h1>
    <p class="chooser-sub">RÃ©ponds Ã  quelques questions et on te recommande le meilleur modÃ¨le pour ton problÃ¨me.</p>
  </div>

  <!-- Decision flow -->
  <div class="chooser-flow" id="chooserFlow">

    <!-- Q1: Type de problÃ¨me -->
    <div class="chooser-step active" id="step1" data-step="1">
      <div class="chooser-q-num">Question 1</div>
      <h2 class="chooser-question">Quel est ton objectif ?</h2>
      <div class="chooser-options">
        <button class="chooser-opt" onclick="answer(1, 'regression')">
          <span class="chooser-opt-icon">ğŸ“ˆ</span>
          <div>
            <div class="chooser-opt-title">PrÃ©dire un nombre</div>
            <div class="chooser-opt-desc">Prix, salaire, tempÃ©rature, durÃ©eâ€¦</div>
          </div>
        </button>
        <button class="chooser-opt" onclick="answer(1, 'classification')">
          <span class="chooser-opt-icon">ğŸ·ï¸</span>
          <div>
            <div class="chooser-opt-title">PrÃ©dire une catÃ©gorie</div>
            <div class="chooser-opt-desc">Spam/pas spam, fraude, type de clientâ€¦</div>
          </div>
        </button>
        <button class="chooser-opt" onclick="answer(1, 'clustering')">
          <span class="chooser-opt-icon">ğŸ§©</span>
          <div>
            <div class="chooser-opt-title">Grouper sans labels</div>
            <div class="chooser-opt-desc">Segmentation, patterns cachÃ©sâ€¦</div>
          </div>
        </button>
        <button class="chooser-opt" onclick="answer(1, 'images')">
          <span class="chooser-opt-icon">ğŸ–¼ï¸</span>
          <div>
            <div class="chooser-opt-title">Classifier des images</div>
            <div class="chooser-opt-desc">ReconnaÃ®tre des objets, des visagesâ€¦</div>
          </div>
        </button>
        <button class="chooser-opt" onclick="answer(1, 'sequences')">
          <span class="chooser-opt-icon">ğŸ“</span>
          <div>
            <div class="chooser-opt-title">Traiter des sÃ©quences / texte</div>
            <div class="chooser-opt-desc">SÃ©ries temporelles, NLP, traductionâ€¦</div>
          </div>
        </button>
      </div>
    </div>

    <!-- Q2: Taille du dataset -->
    <div class="chooser-step" id="step2" data-step="2">
      <div class="chooser-q-num">Question 2</div>
      <h2 class="chooser-question">Combien de donnÃ©es ?</h2>
      <div class="chooser-options">
        <button class="chooser-opt" onclick="answer(2, 'small')">
          <span class="chooser-opt-icon">ğŸ“„</span>
          <div>
            <div class="chooser-opt-title">&lt; 1 000 lignes</div>
            <div class="chooser-opt-desc">Petit dataset, donnÃ©es limitÃ©es</div>
          </div>
        </button>
        <button class="chooser-opt" onclick="answer(2, 'medium')">
          <span class="chooser-opt-icon">ğŸ“‘</span>
          <div>
            <div class="chooser-opt-title">1 000 â€“ 100 000 lignes</div>
            <div class="chooser-opt-desc">Dataset standard</div>
          </div>
        </button>
        <button class="chooser-opt" onclick="answer(2, 'large')">
          <span class="chooser-opt-icon">ğŸ—„ï¸</span>
          <div>
            <div class="chooser-opt-title">&gt; 100 000 lignes</div>
            <div class="chooser-opt-desc">Gros volume de donnÃ©es</div>
          </div>
        </button>
      </div>
    </div>

    <!-- Q3: InterprÃ©tabilitÃ© -->
    <div class="chooser-step" id="step3" data-step="3">
      <div class="chooser-q-num">Question 3</div>
      <h2 class="chooser-question">As-tu besoin d'expliquer le modÃ¨le ?</h2>
      <div class="chooser-options">
        <button class="chooser-opt" onclick="answer(3, 'yes')">
          <span class="chooser-opt-icon">ğŸ”</span>
          <div>
            <div class="chooser-opt-title">Oui, c'est important</div>
            <div class="chooser-opt-desc">MÃ©dical, finance, juridique â€” il faut justifier les dÃ©cisions</div>
          </div>
        </button>
        <button class="chooser-opt" onclick="answer(3, 'no')">
          <span class="chooser-opt-icon">ğŸ¯</span>
          <div>
            <div class="chooser-opt-title">Non, la performance prime</div>
            <div class="chooser-opt-desc">Kaggle, recommandation, dÃ©tection automatique</div>
          </div>
        </button>
      </div>
    </div>

    <!-- Result -->
    <div class="chooser-result" id="chooserResult" style="display:none">
      <div class="chooser-result-icon" id="resultIcon"></div>
      <h2 class="chooser-result-title">Notre recommandation</h2>

      <div class="chooser-reco-cards" id="recoCards"></div>

      <div class="chooser-result-path" id="resultPath"></div>

      <div class="chooser-result-actions">
        <button class="chooser-restart-btn" onclick="restart()">ğŸ”„ Recommencer</button>
        <a href="/" class="chooser-back-btn">â† Retour Ã  l'accueil</a>
      </div>
    </div>

  </div>
</div>

<script>
(function() {
  var answers = {};

  var recommendations = {
    // Regression
    'regression_small_yes': {
      icon: 'ğŸ“ˆ', models: [
        { name: 'RÃ©gression LinÃ©aire / Ridge', icon: 'ğŸ“ˆ', why: 'InterprÃ©table, coefficients lisibles, robuste sur peu de donnÃ©es.', link: '/workflows/linreg' },
        { name: 'Arbre de DÃ©cision (max_depth limitÃ©)', icon: 'ğŸŒ³', why: 'RÃ¨gles explicables, pas besoin de scaling.', link: '/workflows/trees' }
      ]},
    'regression_small_no': {
      icon: 'ğŸ“ˆ', models: [
        { name: 'Random Forest Regressor', icon: 'ğŸŒ²', why: 'Robuste mÃªme sur peu de donnÃ©es, peu de tuning.', link: '/workflows/trees' },
        { name: 'KNN Regressor', icon: 'ğŸ”µ', why: 'Simple et efficace sur petits datasets.', link: '/workflows/knn' }
      ]},
    'regression_medium_yes': {
      icon: 'ğŸ“ˆ', models: [
        { name: 'Ridge / Lasso', icon: 'ğŸ“ˆ', why: 'Coefficients interprÃ©tables + rÃ©gularisation.', link: '/workflows/linreg' },
        { name: 'Random Forest + feature_importances_', icon: 'ğŸŒ²', why: 'Moins interprÃ©table mais donne les features clÃ©s.', link: '/workflows/trees' }
      ]},
    'regression_medium_no': {
      icon: 'ğŸš€', models: [
        { name: 'XGBoost Regressor', icon: 'ğŸš€', why: 'Meilleure performance sur donnÃ©es tabulaires. Le standard Kaggle.', link: '/workflows/boosting' },
        { name: 'Random Forest Regressor', icon: 'ğŸŒ²', why: 'Solide backup, moins de tuning nÃ©cessaire.', link: '/workflows/trees' }
      ]},
    'regression_large_yes': {
      icon: 'ğŸ“ˆ', models: [
        { name: 'Ridge / Lasso', icon: 'ğŸ“ˆ', why: 'Scale bien, interprÃ©table mÃªme sur gros volume.', link: '/workflows/linreg' },
        { name: 'Random Forest (limitÃ© en profondeur)', icon: 'ğŸŒ²', why: 'feature_importances_ pour expliquer.', link: '/workflows/trees' }
      ]},
    'regression_large_no': {
      icon: 'ğŸš€', models: [
        { name: 'XGBoost Regressor', icon: 'ğŸš€', why: 'Performance maximale, gÃ¨re les gros volumes.', link: '/workflows/boosting' },
        { name: 'Neural Network (Dense)', icon: 'ğŸ§ ', why: 'Si XGBoost plafonne, le deep learning prend le relai.', link: '/workflows/nn' }
      ]},

    // Classification
    'classification_small_yes': {
      icon: 'ğŸ¯', models: [
        { name: 'RÃ©gression Logistique', icon: 'ğŸ¯', why: 'ProbabilitÃ©s calibrÃ©es, coefficients interprÃ©tables.', link: '/workflows/logreg' },
        { name: 'Arbre de DÃ©cision', icon: 'ğŸŒ³', why: 'RÃ¨gles if/else lisibles, parfait pour le mÃ©dical.', link: '/workflows/trees' }
      ]},
    'classification_small_no': {
      icon: 'ğŸ¯', models: [
        { name: 'Random Forest Classifier', icon: 'ğŸŒ²', why: 'Robuste, bon par dÃ©faut.', link: '/workflows/trees' },
        { name: 'SVM (kernel RBF)', icon: 'â¬›', why: 'Puissant sur petits datasets haute dimension.', link: '/workflows/svm' }
      ]},
    'classification_medium_yes': {
      icon: 'ğŸ¯', models: [
        { name: 'RÃ©gression Logistique', icon: 'ğŸ¯', why: 'Le standard pour la classification interprÃ©table.', link: '/workflows/logreg' },
        { name: 'Arbre de DÃ©cision (prunÃ©)', icon: 'ğŸŒ³', why: 'Visualisable, explicable aux non-techniques.', link: '/workflows/trees' }
      ]},
    'classification_medium_no': {
      icon: 'ğŸš€', models: [
        { name: 'XGBoost Classifier', icon: 'ğŸš€', why: 'Top performance sur donnÃ©es tabulaires.', link: '/workflows/boosting' },
        { name: 'Random Forest Classifier', icon: 'ğŸŒ²', why: 'Valeur sÃ»re, bonne baseline.', link: '/workflows/trees' }
      ]},
    'classification_large_yes': {
      icon: 'ğŸ¯', models: [
        { name: 'RÃ©gression Logistique', icon: 'ğŸ¯', why: 'Scale parfaitement, reste interprÃ©table.', link: '/workflows/logreg' }
      ]},
    'classification_large_no': {
      icon: 'ğŸš€', models: [
        { name: 'XGBoost Classifier', icon: 'ğŸš€', why: 'Le meilleur sur donnÃ©es tabulaires massives.', link: '/workflows/boosting' },
        { name: 'Neural Network + Dropout', icon: 'ğŸ§ ', why: 'Quand les donnÃ©es sont trÃ¨s nombreuses et complexes.', link: '/workflows/nn' }
      ]},

    // Clustering (skip Q3)
    'clustering_small_any': {
      icon: 'ğŸ§©', models: [
        { name: 'K-Means', icon: 'ğŸ§©', why: 'Simple, efficace, mÃ©thode du coude pour choisir K.', link: '/workflows/kmeans' },
      ]},
    'clustering_medium_any': {
      icon: 'ğŸ§©', models: [
        { name: 'K-Means', icon: 'ğŸ§©', why: 'Standard, rapide, scalable.', link: '/workflows/kmeans' },
      ]},
    'clustering_large_any': {
      icon: 'ğŸ§©', models: [
        { name: 'K-Means (Mini-Batch)', icon: 'ğŸ§©', why: 'Version scalable pour gros volumes.', link: '/workflows/kmeans' },
      ]},

    // Images (skip Q2, Q3)
    'images_any_any': {
      icon: 'ğŸ–¼ï¸', models: [
        { name: 'CNN + Transfer Learning (VGG16)', icon: 'ğŸ–¼ï¸', why: 'RÃ©utilise des features prÃ©-apprises sur ImageNet. Efficace mÃªme avec peu d\'images.', link: '/workflows/cnn' },
      ]},

    // Sequences (skip Q2, Q3)
    'sequences_any_any': {
      icon: 'ğŸ“', models: [
        { name: 'LSTM (Long Short-Term Memory)', icon: 'ğŸ“', why: 'MÃ©moire longue pour les sÃ©quences. Standard pour le NLP et les sÃ©ries temporelles.', link: '/workflows/rnn' },
      ]},
  };

  window.answer = function(step, value) {
    answers[step] = value;

    // Highlight selected
    var btns = document.querySelectorAll('#step' + step + ' .chooser-opt');
    btns.forEach(function(b) { b.classList.remove('selected'); });
    event.currentTarget.classList.add('selected');

    // Special paths: images/sequences skip to result
    if (step === 1 && (value === 'images' || value === 'sequences')) {
      setTimeout(function() { showResult(); }, 300);
      return;
    }

    // Clustering: skip Q3
    if (step === 2 && answers[1] === 'clustering') {
      setTimeout(function() { showResult(); }, 300);
      return;
    }

    // Normal flow: show next step
    var nextStep = step + 1;
    if (nextStep <= 3) {
      setTimeout(function() {
        document.getElementById('step' + nextStep).classList.add('active');
        document.getElementById('step' + nextStep).scrollIntoView({ behavior: 'smooth', block: 'center' });
      }, 300);
    } else {
      setTimeout(function() { showResult(); }, 300);
    }
  };

  function showResult() {
    var type = answers[1] || 'regression';
    var size = answers[2] || 'any';
    var interp = answers[3] || 'any';

    var key = type + '_' + size + '_' + interp;
    var reco = recommendations[key];
    if (!reco) {
      // Fallback
      key = type + '_any_any';
      reco = recommendations[key];
    }
    if (!reco) {
      reco = { icon: 'ğŸ¤”', models: [{ name: 'Pas de recommandation', icon: 'â“', why: 'Combinaison non couverte.', link: '/' }] };
    }

    document.getElementById('resultIcon').textContent = reco.icon;

    var cardsHtml = reco.models.map(function(m, idx) {
      return '<a href="' + m.link + '" class="chooser-reco-card' + (idx === 0 ? ' reco-primary' : '') + '">' +
        '<div class="reco-card-rank">' + (idx === 0 ? 'ğŸ¥‡ Premier choix' : 'ğŸ¥ˆ Alternative') + '</div>' +
        '<div class="reco-card-header"><span class="reco-card-icon">' + m.icon + '</span><span class="reco-card-name">' + m.name + '</span></div>' +
        '<div class="reco-card-why">' + m.why + '</div>' +
        '<div class="reco-card-link">Voir le workflow â†’</div>' +
      '</a>';
    }).join('');
    document.getElementById('recoCards').innerHTML = cardsHtml;

    // Show path
    var pathParts = [];
    if (answers[1]) pathParts.push(answers[1]);
    if (answers[2]) pathParts.push(answers[2]);
    if (answers[3]) pathParts.push('interprÃ©table=' + answers[3]);
    document.getElementById('resultPath').innerHTML = '<span class="path-label">Ton chemin :</span> ' +
      pathParts.map(function(p) { return '<span class="path-tag">' + p + '</span>'; }).join(' â†’ ');

    document.getElementById('chooserResult').style.display = '';
    document.getElementById('chooserResult').scrollIntoView({ behavior: 'smooth', block: 'center' });
  }

  window.restart = function() {
    answers = {};
    document.querySelectorAll('.chooser-step').forEach(function(s, i) {
      if (i === 0) s.classList.add('active');
      else s.classList.remove('active');
    });
    document.querySelectorAll('.chooser-opt').forEach(function(b) { b.classList.remove('selected'); });
    document.getElementById('chooserResult').style.display = 'none';
    document.getElementById('step1').scrollIntoView({ behavior: 'smooth', block: 'center' });
  };
})();
</script>
